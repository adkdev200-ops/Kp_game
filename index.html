<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Flappy Bird Ultra</title>
  <style>
    :root {
      --game-max-width: 520px;
      --game-radius: 24px;
      --overlay-bg: rgba(0, 0, 0, 0.85);
      --glow: 0 20px 60px rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      overflow: hidden;
      font-family: "Segoe UI", Arial, sans-serif;
      background: radial-gradient(circle at top, #132347, #050b18 65%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: clamp(12px, 4vw, 36px);
      color: #fff;
    }

    .game-wrapper {
      position: relative;
      width: min(100%, var(--game-max-width));
      max-width: var(--game-max-width);
      height: auto;
    }

    canvas {
      display: block;
      width: 100%;
      height: auto;
      border-radius: var(--game-radius);
      box-shadow: var(--glow);
      background: #000;
    }

    #game-over-screen {
      position: absolute;
      inset: 0;
      border-radius: var(--game-radius);
      background: var(--overlay-bg);
      backdrop-filter: blur(6px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      color: white;
      animation: fadeIn 0.6s ease;
      padding: clamp(24px, 6vw, 48px);
      text-align: center;
    }

    #game-over-img {
      width: clamp(160px, 45vw, 240px);
      margin-bottom: 20px;
    }

    #game-over-screen h1 {
      font-size: clamp(32px, 8vw, 48px);
      margin: 0;
    }

    #final-score {
      font-size: clamp(20px, 6vw, 30px);
      margin: 12px 0 20px;
    }

    #restart-btn {
      width: min(100%, 280px);
      padding: clamp(12px, 3.5vw, 16px);
      font-size: clamp(18px, 4vw, 24px);
      border: none;
      background: linear-gradient(135deg, #ffcb00, #ff9500);
      color: #000;
      border-radius: 14px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }

    #restart-btn:active {
      transform: scale(0.98);
    }

    #restart-btn:hover {
      transform: scale(1.04);
    }

    .hint {
      margin-top: 18px;
      font-size: clamp(15px, 3.5vw, 18px);
      letter-spacing: 0.5px;
      opacity: 0.85;
      text-align: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @media (max-width: 640px) {
      :root {
        --game-max-width: 100vw;
        --game-radius: 0;
      }

      body {
        padding: 0;
        overflow: hidden;
      }

      .game-wrapper {
        width: 100vw;
        height: 100vh;
      }

      canvas {
        width: 100vw;
        height: 100vh;
        border-radius: 0;
      }

      #game-over-screen {
        border-radius: 0;
      }

      .hint {
        font-size: 16px;
        padding: 12px 18px;
        background: rgba(0, 0, 0, 0.45);
        border-radius: 999px;
        position: absolute;
        bottom: 18px;
        left: 50%;
        transform: translateX(-50%);
        margin: 0;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <canvas id="gameCanvas" width="480" height="640" aria-label="Flappy Bird Ultra game canvas"></canvas>

    <div id="game-over-screen" role="dialog" aria-modal="true">
      <img id="game-over-img" src="gameover.png" alt="Game over" />
      <h1>Game Over</h1>
      <p id="final-score"></p>
      <button id="restart-btn">Restart</button>
    </div>
  </div>
  <p class="hint">Tap / Click or press Space to flap</p>

<script>
// ------------------ BASE SETUP --------------------
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const bg = new Image(); bg.src = "background.png";
const birdHead = new Image(); birdHead.src = "kp.png";
const pipeImg = new Image(); pipeImg.src = "sushila.png";

const flapSound = new Audio("flap.mp3");
const bgMusic = new Audio("background.mp3"); bgMusic.loop = true;
const hitSound = new Audio("hit.mp3");

function tryPlay(audio) {
  const attempt = audio.play();
  if (attempt && typeof attempt.catch === "function") {
    attempt.catch(() => {});
  }
}

// ------------------ GAME OBJECTS --------------------
let bird = {
  x: 100,
  y: 260,
  width: 55,
  height: 55,
  velocity: 0,
  gravity: 0.38,
  lift: -7.2,
  rotation: 0
};

let pipes = [];
let frame = 0;
let score = 0;
let gameOver = false;
let pipeGap = 160;
let pipeSpeed = 3;

const viewportQuery = window.matchMedia("(max-width: 640px)");
const physicsPresets = {
  desktop: { gravity: 0.25, lift: -5.5, gap: 220, speed: 1.9 },
  mobile: { gravity: 0.18, lift: -4.6, gap: 250, speed: 1.6 }
};

function syncPhysicsWithViewport() {
  const preset = viewportQuery.matches ? physicsPresets.mobile : physicsPresets.desktop;
  bird.gravity = preset.gravity;
  bird.lift = preset.lift;
  pipeGap = preset.gap;
  pipeSpeed = preset.speed;
}

syncPhysicsWithViewport();

if (typeof viewportQuery.addEventListener === "function") {
  viewportQuery.addEventListener("change", syncPhysicsWithViewport);
} else if (typeof viewportQuery.addListener === "function") {
  viewportQuery.addListener(syncPhysicsWithViewport);
}

// ------------------ PHYSICS --------------------
function updateBird() {
  bird.velocity += bird.gravity;
  bird.y += bird.velocity;
  bird.rotation = Math.min(Math.max(bird.velocity * 0.15, -0.8), 1.2);

  if (bird.y + bird.height > canvas.height) endGame();
  if (bird.y < 0) bird.y = 0;
}

function drawBird() {
  ctx.save();
  ctx.translate(bird.x + bird.width/2, bird.y + bird.height/2);
  ctx.rotate(bird.rotation);
  ctx.drawImage(birdHead, -bird.width/2, -bird.height/2, bird.width, bird.height);
  ctx.restore();
}

// ------------------ PIPES --------------------
function createPipe() {
  let top = Math.floor(Math.random() * 250) + 80;
  pipes.push({ x: canvas.width, top: top, bottom: top + pipeGap, width: 80, passed: false });
}

function drawPipes() {
  pipes.forEach(p => {
    ctx.drawImage(pipeImg, p.x, 0, p.width, p.top);
    ctx.drawImage(pipeImg, p.x, p.bottom, p.width, canvas.height - p.bottom);
  });
}

function updatePipes() {
  pipes.forEach(p => {
    p.x -= pipeSpeed;

    if (p.x + p.width < bird.x && !p.passed) {
      p.passed = true;
      score++;
    }

    if (collision(p)) endGame();
  });

  pipes = pipes.filter(p => p.x + p.width > 0);
}

function collision(p) {
  if (bird.x < p.x + p.width && bird.x + bird.width > p.x) {
    if (bird.y < p.top || bird.y + bird.height > p.bottom) return true;
  }
  return false;
}

// ------------------ UI --------------------
function drawScore() {
  ctx.fillStyle = "white";
  ctx.font = "40px Arial Black";
  ctx.fillText(score, 20, 50);
}

// ------------------ LOOP --------------------
function loop() {
  if (gameOver) return;

  ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
  drawBird();
  drawPipes();
  drawScore();

  updateBird();
  updatePipes();

  if (frame % 95 === 0) createPipe();
  frame++;

  requestAnimationFrame(loop);
}

// ------------------ FLAP --------------------
function flap() {
  if (gameOver) return;
  bird.velocity = bird.lift;
  flapSound.currentTime = 0;
  tryPlay(flapSound);
}

function handleInput(event) {
  if (event) event.preventDefault();
  startGameAudio();
  flap();
}

document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    e.preventDefault();
    handleInput();
  }
});

if (window.PointerEvent) {
  window.addEventListener("pointerdown", e => {
    if (e.pointerType === "mouse" && e.button !== 0) return;
    handleInput(e);
  }, { passive: false });
} else {
  window.addEventListener("mousedown", e => {
    if (e.button !== 0) return;
    handleInput(e);
  });
  window.addEventListener("touchstart", e => handleInput(e), { passive: false });
}

// ------------------ END GAME --------------------
function endGame() {
  gameOver = true;
  bgMusic.pause();
  hitSound.currentTime = 0;
  tryPlay(hitSound);

  document.getElementById("final-score").innerText = "Score: " + score;
  document.getElementById("game-over-screen").style.visibility = "visible";
}

// ------------------ RESTART --------------------
document.getElementById("restart-btn").onclick = () => {
  hitSound.pause();
  hitSound.currentTime = 0;

  bird.y = 260;
  bird.velocity = 0;
  bird.rotation = 0;
  pipes = [];
  score = 0;
  frame = 0;
  gameOver = false;

  document.getElementById("game-over-screen").style.visibility = "hidden";
  bgMusic.currentTime = 0;
  tryPlay(bgMusic);
  loop();
};

// ------------------ AUDIO UNLOCK (Fix autoplay) --------------------
let started = false;
function startGameAudio() {
  if (!started) {
    started = true;
    tryPlay(bgMusic);
  }
}

// ------------------ START --------------------
bg.onload = () => {
  loop();
};
</script>
</body>
</html>

