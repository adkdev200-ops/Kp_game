<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Flappy Bird Ultra</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: Arial; }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }

    #game-over-screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(6px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      color: white;
      animation: fadeIn 0.6s ease;
    }

    #restart-btn {
      padding: 14px 30px;
      font-size: 24px;
      border: none;
      background: linear-gradient(135deg, #ffcb00, #ff9500);
      color: #000;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 20px;
      transition: 0.2s;
    }

    #restart-btn:hover {
      transform: scale(1.1);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <div id="game-over-screen">
    <img id="game-over-img" src="gameover.png" style="width:220px; margin-bottom:20px;" />
    <h1 style="font-size:48px; margin:0;">Game Over</h1>
    <p id="final-score" style="font-size:28px; margin:10px 0 20px;"></p>
    <button id="restart-btn">Restart</button>
  </div>

<script>
// ------------------ BASE SETUP --------------------
const canvas = document.getElementById("gameCanvas");
// Resize for fullscreen mobile
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const ctx = canvas.getContext("gameCanvas");
const ctx = canvas.getContext("2d");

const bg = new Image(); bg.src = "background.png";
const birdHead = new Image(); birdHead.src = "kp.png";
const pipeImg = new Image(); pipeImg.src = "sushila.png";

const flapSound = new Audio("flap.mp3");
const bgMusic = new Audio("background.mp3"); bgMusic.loop = true;
const hitSound = new Audio("hit.mp3");

// ------------------ GAME OBJECTS --------------------
let bird = {
  x: 100,
  y: 260,
  width: 55,
  height: 55,
  velocity: 0,
  gravity: 0.38,
  lift: -7.2,
  rotation: 0
};

let pipes = [];
let frame = 0;
let score = 0;
let gameOver = false;
let pipeGap = 160;

// ------------------ PHYSICS --------------------
function updateBird() {
  bird.velocity += bird.gravity;
  bird.y += bird.velocity;
  bird.rotation = Math.min(Math.max(bird.velocity * 0.15, -0.8), 1.2);

  if (bird.y + bird.height > canvas.height) endGame();
  if (bird.y < 0) bird.y = 0;
}

function drawBird() {
  ctx.save();
  ctx.translate(bird.x + bird.width/2, bird.y + bird.height/2);
  ctx.rotate(bird.rotation);
  ctx.drawImage(birdHead, -bird.width/2, -bird.height/2, bird.width, bird.height);
  ctx.restore();
}

// ------------------ PIPES --------------------
function createPipe() {
  let top = Math.floor(Math.random() * 250) + 80;
  pipes.push({ x: canvas.width, top: top, bottom: top + pipeGap, width: 80, passed: false });
}

function drawPipes() {
  pipes.forEach(p => {
    ctx.drawImage(pipeImg, p.x, 0, p.width, p.top);
    ctx.drawImage(pipeImg, p.x, p.bottom, p.width, canvas.height - p.bottom);
  });
}

function updatePipes() {
  pipes.forEach(p => {
    p.x -= 3;

    if (p.x + p.width < bird.x && !p.passed) {
      p.passed = true;
      score++;
    }

    if (collision(p)) endGame();
  });

  pipes = pipes.filter(p => p.x + p.width > 0);
}

function collision(p) {
  if (bird.x < p.x + p.width && bird.x + bird.width > p.x) {
    if (bird.y < p.top || bird.y + bird.height > p.bottom) return true;
  }
  return false;
}

// ------------------ UI --------------------
function drawScore() {
  ctx.fillStyle = "white";
  ctx.font = "40px Arial Black";
  ctx.fillText(score, 20, 50);
}

// ------------------ LOOP --------------------
function loop() {
  if (gameOver) return;

  ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
  drawBird();
  drawPipes();
  drawScore();

  updateBird();
  updatePipes();

  if (frame % 95 === 0) createPipe();
  frame++;

  requestAnimationFrame(loop);
}

// ------------------ FLAP --------------------
function flap() {
  if (gameOver) return;
  bird.velocity = bird.lift;
  flapSound.currentTime = 0;
  flapSound.play();
}

document.addEventListener("keydown", e => { if (e.code === "Space") flap(); });
document.addEventListener("mousedown", () => {
  startGameAudio();
  flap();
});

document.addEventListener("touchstart", () => {
  startGameAudio();
  flap();
});, flap);

// ------------------ END GAME --------------------
function endGame() {
  gameOver = true;
  bgMusic.pause();
  hitSound.currentTime = 0;
  hitSound.play();

  document.getElementById("final-score").innerText = "Score: " + score;
  document.getElementById("game-over-screen").style.visibility = "visible";
}

// ------------------ RESTART --------------------
document.getElementById("restart-btn").onclick = () => {
  hitSound.pause();
  hitSound.currentTime = 0;

  bird.y = 260;
  bird.velocity = 0;
  bird.rotation = 0;
  pipes = [];
  score = 0;
  frame = 0;
  gameOver = false;

  document.getElementById("game-over-screen").style.visibility = "hidden";
  bgMusic.currentTime = 0;
  bgMusic.play();
  loop();
};

// ------------------ AUDIO UNLOCK (Fix autoplay) --------------------
let started = false;
function startGameAudio() {
  if (!started) {
    bgMusic.play();
    started = true;
  }
}

document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    startGameAudio();
    flap();
  }
});

document.addEventListener("mousedown", () => {
  startGameAudio();
  flap();
});

// ------------------ START --------------------
bg.onload = () => {
  bgMusic.play();
  loop();
};
</script>
</body>
</html>
